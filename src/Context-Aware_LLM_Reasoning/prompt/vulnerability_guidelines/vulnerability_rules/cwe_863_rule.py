CWE_863_RULE = """
[CWE-863 Reference Guideline | Incorrect Authorization | Non-binding, Evidence-first]

Overview
- CWE-863 occurs when a product performs an authorization check when an actor attempts to access a resource or perform an action, but the check is either missing or incorrectly implemented.
- This can allow unauthorized actors to perform actions or access resources they should not be able to, leading to potential data breaches, unauthorized modifications, or other security issues.
- In partial snippets, missing or incorrect authorization checks are not proof of vulnerability. Use this guideline to form hypotheses and identify code evidence that would confirm or refute them.

What counts as "authorization check" and "incorrect implementation" (static analysis framing)
- Authorization Check:
  - The process of verifying that a user or system has the appropriate permissions or rights to access a resource or perform an action. 
  - This typically involves checking the user's role, permissions, or attributes to determine if they are authorized to perform the requested operation (e.g., using RBAC, ABAC, or similar mechanisms).
- Incorrect Authorization Implementation:
  - A situation where the authorization check is either missing, incorrectly implemented, or is bypassed, allowing unauthorized users to access or modify resources they should not be able to access.
  - Examples of incorrect implementation include flaws in the logic that checks roles or permissions, failing to apply checks consistently, or misconfigured security policies.

Where incorrect authorization issues typically occur (sensitive sinks)
- Data access controls:
  - Allowing unauthorized users to access, view, or modify sensitive data, such as user accounts, financial records, or personally identifiable information (PII).
- Resource modification:
  - Allowing unauthorized actors to modify resources such as system configurations, database entries, or application settings that should be restricted to authorized users.
- API or service endpoints:
  - Exposing API or service endpoints without properly validating whether the actor has the necessary permissions to perform the requested action or access the resource.
- Administrative functions:
  - Allowing users to perform administrative tasks, such as changing system settings or managing other users, without verifying that the user has the correct administrative privileges.

Common failure modes (reasoning hints, not assumptions)
- Incorrect role-based access control (RBAC):
  - The application incorrectly grants access to sensitive resources based on misconfigured or insufficient role-based access policies.
- Missing or incomplete permission checks:
  - Certain actions or resources do not properly validate whether the user has the appropriate permissions before allowing access or performing actions.
- Over-permissioned users:
  - Users are granted excessive or inappropriate permissions, allowing them to perform actions or access data they should not be able to.
- Bypassing or insufficient authorization logic:
  - The authorization checks are either bypassed (e.g., through insecure URL paths, query parameters, or indirect access) or implemented incorrectly, failing to restrict access as intended.

What “correct authorization mechanisms” look like (context-specific)
- Enforcing the principle of least privilege:
  - Ensure that users or systems only have the minimum permissions needed to perform their tasks. Each action or resource access should be checked to ensure that the actor has the required permissions.
- Consistent role-based access control (RBAC):
  - Implement clear and enforceable role-based access control policies, where roles are associated with specific permissions and the application checks these roles before granting access or performing an action.
- Apply authorization checks consistently:
  - Ensure that authorization checks are applied to every resource access or action in the application, including for both API endpoints and UI actions.
- Secure authentication and session management:
  - Ensure that all requests are authenticated and that authorization checks are based on the authenticated user's role, permissions, or attributes.
- Fine-grained access control:
  - Implement detailed permissions for actions (e.g., read, write, delete) that are checked before the user can access or modify resources.

Common weak/insufficient defenses (signals of possible risk)
- No authorization check:
  - Some actions or resources are accessible without performing any authorization check, allowing unauthorized access or modification.
- Incorrect role or permission checks:
  - Role-based checks or permission checks are incorrectly implemented, either by granting excessive access or by failing to properly evaluate the user’s rights.
- Overly permissive access controls:
  - Users are granted broad or unnecessary permissions, allowing them to perform actions or access data that should be restricted to others.
- Inconsistent implementation of authorization:
  - Authorization checks are missing or inconsistently applied across different endpoints, resources, or actions within the application.

Evidence to look for in code (static snippet oriented)
- Strong evidence of mitigation:
  - Explicit authorization checks before accessing resources or performing actions (e.g., `if (user.hasPermission("edit_resource"))`).
  - Role-based or attribute-based access control (RBAC/ABAC) ensuring that only authorized users can perform sensitive actions.
  - Consistent checks for permissions or roles on all endpoints and functions that access or modify sensitive resources.
  - Secure error handling when authorization fails, such as returning `403 Forbidden` rather than exposing details about why access was denied.
- Evidence suggesting vulnerability:
  - Missing or improperly implemented authorization checks that allow users to access or modify resources without verifying permissions.
  - Over-permissive roles or users being able to perform unauthorized actions (e.g., regular users accessing admin-only functionality).
  - Authorization logic that is bypassed or incorrectly evaluated, allowing unauthorized access to sensitive data or functionality.

How to use this guideline under incomplete context
- Identify where authorization is applied:
  - Are there explicit checks for user roles or permissions before resources or actions are accessed? Where are these checks missing?
- Identify the access control mechanisms:
  - Is role-based access control (RBAC), attribute-based access control (ABAC), or another form of authorization used to enforce restrictions?
- Generate a small number of targeted hypotheses:
  - H1: Authorization checks are missing or incorrectly implemented, allowing unauthorized access to sensitive resources or actions.
  - H2: Roles or permissions are misconfigured, allowing users to access resources they should not have access to.
  - H3: Authorization checks are applied inconsistently across the application, leading to gaps in access control enforcement.
  - H4: Users are granted excessive permissions that exceed their necessary access rights.
- For each hypothesis, specify:
  (a) evidence in the snippet supporting it (e.g., missing checks, overly permissive roles),
  (b) evidence needed to confirm it (e.g., role checks, explicit permission validation),
  (c) counter-evidence that would refute it (e.g., consistent and thorough authorization checks).

Quick red flags in partial code (weak → strong)
- Strong: Sensitive resources or actions are accessed or performed without any authorization checks or verification of the user's permissions.
- Medium: Authorization checks are present but are either incorrect or inconsistently applied to different actions or resources.
- Medium: Roles or permissions are incorrectly configured, granting users excessive access.
- Weak: Authorization logic might be handled by external systems or libraries not visible in the snippet → treat as Unknown and reduce confidence.
"""
if __name__ == "__main__":
    print(CWE_863_RULE)

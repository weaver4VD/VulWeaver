CWE_862_RULE = """
[CWE-862 Reference Guideline | Missing Authorization | Non-binding, Evidence-first]

Overview
- CWE-862 occurs when the product fails to perform an authorization check when an actor attempts to access a resource or perform an action.
- Without proper authorization checks, unauthorized users can access or manipulate sensitive resources, leading to potential data breaches, security vulnerabilities, or unintended actions being performed.
- In partial snippets, missing or incomplete authorization checks are not proof of vulnerability. Use this guideline to form hypotheses and identify code evidence that would confirm or refute them.

What counts as "authorization check" and "missing authorization" (static analysis framing)
- Authorization Check:
  - The process of verifying that a user or system has the necessary permissions to access a resource or perform a specific action.
  - This typically involves checking whether the user has the appropriate role or rights to perform the operation (e.g., using role-based access control, attribute-based access control, or similar mechanisms).
- Missing Authorization:
  - A scenario where the application fails to verify whether a user or process is authorized to access or modify a resource, allowing unauthorized access to sensitive information or actions.
  - This can happen when the application lacks any checks for user roles, permissions, or other access control mechanisms before performing an operation or returning sensitive data.

Where missing authorization issues typically occur (sensitive sinks)
- Data access controls:
  - Accessing or modifying sensitive data (e.g., personal information, financial records) without verifying the user’s authorization.
- Resource management:
  - Performing actions on resources (e.g., deleting files, modifying configurations) without proper authorization checks.
- API or service endpoints:
  - Exposing APIs or services that can be accessed by unauthorized users, allowing them to invoke sensitive operations or retrieve confidential information.
- User actions:
  - Performing administrative or privileged actions, such as account management, without verifying the user’s permissions.

Common failure modes (reasoning hints, not assumptions)
- Missing or ineffective role checks:
  - The system fails to validate whether the user’s role or permissions allow them to perform a specific action or access a resource.
- Lack of input validation in access control:
  - Input from users or external systems is not checked for proper authorization before being processed.
- Failure to enforce least privilege:
  - Users or systems are granted more permissions than necessary, allowing unauthorized actions or access to resources.
- Inconsistent authorization checks:
  - Some parts of the application correctly check for authorization, but other areas (such as API endpoints or admin features) do not enforce proper access control.

What “proper authorization mechanisms” look like (context-specific)
- Role-based or attribute-based access control (RBAC/ABAC):
  - Ensure that authorization checks are performed based on the user’s role or attributes, validating that the user has the appropriate permissions to perform the action or access the resource.
- Implement security policies:
  - Define clear policies on what actions each role or user type can perform and ensure that these policies are consistently applied throughout the application.
- Explicit authorization checks before critical operations:
  - Always validate user roles or permissions before allowing sensitive actions such as data retrieval, modification, or deletion.
- Secure API and service endpoints:
  - Protect sensitive endpoints by verifying that the requesting user has the necessary authorization before processing their request.
- Use of secure authentication and session management:
  - Ensure that users are authenticated before any authorization checks are made, and that session management is properly implemented to track user identity and access rights.

Common weak/insufficient defenses (signals of possible risk)
- No authorization checks:
  - The application performs actions or grants access to sensitive resources without verifying whether the user is authorized to do so.
- Over-permissioned access control:
  - Users are granted excessive permissions, allowing them to perform actions that should be restricted (e.g., granting regular users administrative rights).
- Inconsistent authorization enforcement:
  - Authorization checks are missing in some parts of the application, allowing unauthorized access to certain features or data.
- Lack of user roles or fine-grained access control:
  - The application does not implement granular access control, relying on blanket permissions that are not tailored to the user’s actual needs.

Evidence to look for in code (static snippet oriented)
- Strong evidence of mitigation:
  - Explicit authorization checks before performing sensitive operations (e.g., `if (user.hasPermission("edit_resource"))`).
  - Role-based or attribute-based access control (RBAC/ABAC) that validates user permissions before granting access to resources.
  - API or service endpoints that enforce authentication and authorization checks, ensuring that unauthorized users cannot access sensitive functionality.
  - Proper error handling when unauthorized access is attempted, rejecting unauthorized actions with appropriate status codes (e.g., `403 Forbidden`).
- Evidence suggesting vulnerability:
  - Sensitive operations performed without verifying the user’s role or permissions (e.g., directly accessing a file or performing an action without checking `isAdmin()` or equivalent).
  - Inconsistent or missing authorization checks for certain endpoints, resources, or actions (e.g., administrative tasks that can be accessed by regular users).
  - Insufficient access control that allows unauthorized users to access or modify sensitive data or perform privileged actions.

How to use this guideline under incomplete context
- Identify where authorization is supposed to be applied:
  - What operations or resources in the code require proper authorization checks? Are there places where access to sensitive data or functionality is granted without validation?
- Identify the roles or permissions system in place:
  - Are user roles or permissions used to control access to resources? How are these roles validated before allowing access or performing actions?
- Generate a small number of targeted hypotheses:
  - H1: Authorization checks are missing or incorrectly implemented, allowing unauthorized access to sensitive resources or actions.
  - H2: Role-based or permission checks are inconsistently applied, leaving certain areas of the application vulnerable to unauthorized use.
  - H3: The application grants excessive permissions to users, allowing them to perform actions that should be restricted.
  - H4: Authorization checks exist but are applied in a limited or ineffective way (e.g., only for certain resources or actions).
- For each hypothesis, specify:
  (a) evidence in the snippet supporting it (e.g., missing permission checks, unverified roles),
  (b) evidence needed to confirm it (e.g., explicit authorization checks, user roles/permissions validation),
  (c) counter-evidence that would refute it (e.g., consistent and thorough authorization checks).

Quick red flags in partial code (weak → strong)
- Strong: No authorization checks before accessing or performing sensitive actions, such as modifying data or invoking privileged operations.
- Medium: Authorization checks are present but only apply to some areas of the application, leaving other areas unprotected.
- Medium: Role-based or access control mechanisms are misconfigured or not enforced consistently.
- Weak: Authorization logic may be managed by external systems or libraries not visible in the current snippet → treat as Unknown and reduce confidence.
"""
if __name__ == "__main__":
    print(CWE_862_RULE)

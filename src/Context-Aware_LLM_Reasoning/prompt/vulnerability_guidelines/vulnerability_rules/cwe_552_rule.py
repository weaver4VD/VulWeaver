CWE_552_RULE = """
[CWE-552 Reference Guideline | Files or Directories Accessible to External Parties | Non-binding, Evidence-first]

Overview
- CWE-552 occurs when a product makes files or directories that should be restricted accessible to unauthorized actors, exposing sensitive data or system resources.
- This vulnerability arises from improper access controls, misconfigurations, or lack of proper security measures, which can result in data leakage, unauthorized access to sensitive information, or compromise of critical system components.
- In partial snippets, missing or inadequate access control evidence is not proof of vulnerability. Use this guideline to form hypotheses and identify code evidence that would confirm or refute them.

What counts as “files or directories accessible to external parties” (static analysis framing)
- Files:
  - Sensitive documents, configuration files, backup files, logs, or any file that should not be exposed to unauthorized access.
  - Files that contain PII, authentication data, encryption keys, or other sensitive information.
- Directories:
  - Folders that contain sensitive files, configuration settings, system logs, backups, or internal resources.
  - Web application directories that are inadvertently made accessible to the public, such as `/admin`, `/config`, or `/uploads`.
- Access control mechanisms:
  - Authentication and authorization checks, including file and directory permissions, HTTP access control, and system-level access restrictions.

Where files or directories can be inappropriately exposed (sensitive sinks)
- Web servers or applications:
  - Incorrectly configured web server settings that allow public access to restricted directories or files (e.g., `/config`, `/admin`, or backup directories).
  - Misconfigured `.htaccess`, Nginx, or other web server configuration files that inadvertently expose sensitive directories.
- Misconfigured cloud storage:
  - Incorrect permissions or public access settings on cloud storage systems like AWS S3, Azure Blob Storage, or Google Cloud Storage.
- Local file system misconfigurations:
  - Files or directories on local servers that have incorrect file system permissions, allowing unauthorized access (e.g., `chmod 777` or other overly permissive settings).

Common failure modes (reasoning hints, not assumptions)
- Incorrect file/directory permission settings:
  - Files or directories are granted read, write, or execute permissions to users or groups that should not have access (e.g., world-readable files or public directories).
- Improper configuration of web or cloud resources:
  - Cloud storage buckets, web server directories, or cloud resources are left publicly accessible when they should be restricted.
- Inconsistent or missing access control checks:
  - Files or directories are exposed due to missing or inconsistent access control, failing to properly restrict access based on user roles or authentication.

What “proper access control” looks like (context-specific)
- Restrict access to sensitive files and directories:
  - Set file permissions that limit access to only authorized users (e.g., `chmod 600` for sensitive files, `chmod 700` for directories).
  - Use file access control lists (ACLs) or role-based access control (RBAC) to grant access to resources only for users who need it.
- Use appropriate web server configuration:
  - Restrict web server access to sensitive directories or files by configuring `.htaccess`, `nginx.conf`, or other access control mechanisms properly.
  - Avoid exposing sensitive directories such as `/admin`, `/config`, or `/uploads` to the public unless absolutely necessary.
- Secure cloud storage configurations:
  - Ensure that cloud storage resources (e.g., AWS S3, Google Cloud Storage) are not publicly accessible unless intended, and configure proper permissions for user access.
  - Apply principle of least privilege for access control, ensuring only the necessary parties can read, write, or manage sensitive resources.
- Regularly review and audit access controls:
  - Periodically audit file and directory permissions to ensure that unauthorized users do not have access to sensitive files.
  - Implement logging and monitoring of file access attempts to detect any suspicious or unauthorized activity.

Common weak/insufficient defenses (signals of possible risk)
- Excessive file permissions:
  - Allowing files or directories to be world-readable (`chmod 777`), world-writable, or globally executable.
- Default configurations left unchanged:
  - Leaving default configurations that expose sensitive files or directories (e.g., default web server configurations that allow access to `admin` or `config` directories).
- No access control for sensitive resources:
  - Sensitive files or directories are accessible without authentication or proper role-based access control (e.g., unauthenticated access to `/config`).
- Misconfigured cloud or network storage:
  - Cloud storage buckets, file shares, or other resources are left public or improperly configured to allow unauthorized access.

Evidence to look for in code (static snippet oriented)
- Strong evidence of mitigation:
  - Files and directories are secured with restrictive permissions (e.g., `chmod 600`, `chmod 700`).
  - Web server configurations properly restrict access to sensitive directories (e.g., using `.htaccess`, `nginx.conf`, or equivalent).
  - Cloud storage configurations are locked down with proper access controls (e.g., private buckets, restricted public access).
  - Application-level access controls are used to prevent unauthorized access to files and directories (e.g., RBAC, authentication checks).
- Evidence suggesting vulnerability:
  - Sensitive files or directories are granted overly permissive access (e.g., `chmod 777`, `public-read` settings).
  - Web server configurations allow public access to sensitive directories or files (e.g., `/config`, `/admin`).
  - Cloud storage resources or file shares are publicly accessible without necessary restrictions.
  - No access control is implemented on sensitive resources or files, leading to unauthorized access.

How to use this guideline under incomplete context
- Identify where files and directories are stored and accessed:
  - Are sensitive files or directories exposed by the web server or application? Are access control measures in place for these resources?
- Identify the access control mechanisms:
  - Are proper file and directory permissions set to restrict access to sensitive information? Are resources in cloud storage or network shares configured securely?
- Generate a small number of targeted hypotheses:
  - H1: Files or directories are exposed to unauthorized users due to incorrect permission settings or lack of proper access controls.
  - H2: Web server configurations allow public access to sensitive resources, such as `/config` or `/admin`.
  - H3: Cloud or network resources are improperly configured, allowing public access to sensitive files.
  - H4: Access controls exist, but are misconfigured or not enforced consistently across the application or system.
- For each hypothesis, specify:
  (a) evidence in the snippet supporting it (file permissions, web server configurations, cloud storage settings),
  (b) evidence needed to confirm it (security policies, access control logs, configuration files),
  (c) counter-evidence that would refute it (proper access control in place, restrictive permissions, secure cloud configurations).

Quick red flags in partial code (weak → strong)
- Strong: sensitive files or directories are accessible to all users (e.g., `chmod 777` or world-readable files).
- Medium: web server or cloud storage configurations expose sensitive resources without appropriate restrictions.
- Medium: access controls are missing or weak, allowing unauthorized users to view or manipulate sensitive data.
- Weak: resource access management may be handled externally or in parts of the code not shown → treat as Unknown and reduce confidence.
"""
if __name__ == "__main__":
    print(CWE_552_RULE)

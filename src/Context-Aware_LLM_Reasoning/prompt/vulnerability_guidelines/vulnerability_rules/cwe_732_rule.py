CWE_732_RULE = """
[CWE-732 Reference Guideline | Incorrect Permission Assignment for Critical Resource | Non-binding, Evidence-first]

Overview
- CWE-732 occurs when a product specifies permissions for a security-critical resource in a way that allows that resource to be accessed, read, or modified by unintended actors.
- This vulnerability can lead to unauthorized access, data leakage, or modification of critical resources, which undermines the security and integrity of the system.
- In partial snippets, missing or inadequate permission configuration is not proof of vulnerability. Use this guideline to form hypotheses and identify code evidence that would confirm or refute them.

What counts as “security-critical resources” and “incorrect permission assignment” (static analysis framing)
- Security-critical resources:
  - Resources that contain sensitive or important data, configurations, or system functionality, such as database tables, server configurations, private keys, or authentication credentials.
  - Examples include user data, cryptographic keys, system files, and logs that should only be accessed by authorized users or systems.
- Incorrect permission assignment:
  - Granting permissions (read, write, execute, or admin) to resources inappropriately, either by giving too many privileges to unauthorized users or by improperly restricting access, allowing unintended access or modification.
  - Examples include setting file permissions too permissive (e.g., `chmod 777`), assigning administrative access to non-admin users, or failing to restrict access to sensitive resources in cloud storage or web applications.

Where incorrect permission assignment typically occurs (sensitive sinks)
- File and directory permissions:
  - Files or directories containing sensitive data are granted overly permissive access, such as making files world-readable or world-writable.
- Cloud or network resource configurations:
  - Permissions for cloud storage, network resources, or services are incorrectly configured, making critical data or services publicly accessible.
- Database and system configurations:
  - Database or system files that contain security-critical information (e.g., passwords, configuration files) are not protected by sufficient access controls.
- User roles and access control mechanisms:
  - Role-based access control (RBAC) systems, access control lists (ACLs), or permissions in applications or services are misconfigured, granting inappropriate access to sensitive resources.

Common failure modes (reasoning hints, not assumptions)
- Overly permissive permissions:
  - Resources that are critical for system security are given broad or unrestricted permissions (e.g., `chmod 777` for sensitive files).
- Misconfigured user roles:
  - Users with inadequate privileges are granted excessive access (e.g., giving non-admin users access to administrative files or configurations).
- Insufficient access control on cloud resources:
  - Publicly accessible cloud storage, databases, or file shares that contain sensitive data.
- Inconsistent application of security policies:
  - Security policies or configurations are not applied uniformly across all resources, allowing some resources to be misconfigured with weak or no access control.

What “proper permission assignment” looks like (context-specific)
- Enforce the principle of least privilege:
  - Ensure that resources are only accessible by users, processes, or systems that absolutely need access to them. Assign only the minimal set of permissions necessary.
- Use strong and restrictive permissions:
  - Apply restrictive permissions to critical resources (e.g., use `chmod 600` for sensitive files, limit `read` and `write` access).
- Implement role-based access control (RBAC):
  - Use RBAC or similar mechanisms to ensure that users only have access to the resources they are authorized to use.
- Apply access control to cloud or network resources:
  - Ensure that cloud storage, file shares, and network services are properly secured, restricting access to authorized parties only.
- Secure sensitive system and configuration files:
  - Critical system files, database configurations, and sensitive resources should be properly secured, both in terms of file permissions and access control.

Common weak/insufficient defenses (signals of possible risk)
- Over-permissioned resources:
  - Sensitive files or directories with permissions that are too permissive (e.g., allowing everyone to read or write files).
- Misconfigured role-based access control:
  - Users or services are granted more permissions than necessary, allowing unauthorized access to sensitive resources.
- Publicly accessible cloud or network resources:
  - Cloud storage, databases, or services exposed to unauthorized external users due to improper permission settings or misconfigured access controls.
- Lack of proper auditing and monitoring:
  - Failure to log or monitor who accesses critical resources or to ensure proper access controls are enforced.

Evidence to look for in code (static snippet oriented)
- Strong evidence of mitigation:
  - Explicit role-based or attribute-based access control checks that restrict resources to authorized users or services.
  - Strict file permissions that restrict access to sensitive data (e.g., using `chmod 600` for private files).
  - Secure configuration of cloud services or network resources, with proper access restrictions (e.g., private buckets, secure database connections).
  - Proper configuration of user roles, ensuring that non-admin users do not have access to administrative or critical resources.
- Evidence suggesting vulnerability:
  - Over-permissive file or directory permissions (e.g., `chmod 777`, public-read access for sensitive files).
  - Sensitive resources that are publicly accessible, such as cloud storage or internal databases exposed to the internet.
  - Missing or inadequate access control mechanisms, allowing unauthorized users to access or modify critical resources.
  - Misconfigured role-based access control that grants excessive privileges to non-admin users.

How to use this guideline under incomplete context
- Identify sensitive resources:
  - What resources in the code are considered critical (e.g., database tables, configuration files, cloud storage)?
- Identify permission and access control mechanisms:
  - Are there clear access control checks in place for sensitive resources? Are resources being accessed by users with the appropriate roles or permissions?
- Generate a small number of targeted hypotheses:
  - H1: Sensitive resources are exposed to unauthorized access due to weak or missing permissions.
  - H2: Role-based access control is misconfigured, allowing users with low privileges to access sensitive resources.
  - H3: Critical resources in the cloud or on the network are exposed to unauthorized access.
  - H4: Permissions are handled by external systems or libraries not visible in the code snippet, making them hard to validate.
- For each hypothesis, specify:
  (a) evidence in the snippet supporting it (use of permissions, role checks, publicly accessible resources),
  (b) evidence needed to confirm it (security policy checks, access control logs, resource configurations),
  (c) counter-evidence that would refute it (explicit access control, secure file permissions, properly configured network services).

Quick red flags in partial code (weak → strong)
- Strong: sensitive resources are accessible with overly permissive file permissions (e.g., `chmod 777`) or exposed publicly on the network.
- Medium: role-based or access control mechanisms are either absent or incorrectly configured, leading to excessive privileges.
- Medium: sensitive resources are accessible from external systems or untrusted networks.
- Weak: access control may be managed by external libraries or frameworks not visible in the snippet → treat as Unknown and reduce confidence.
"""
if __name__ == "__main__":
    print(CWE_732_RULE)

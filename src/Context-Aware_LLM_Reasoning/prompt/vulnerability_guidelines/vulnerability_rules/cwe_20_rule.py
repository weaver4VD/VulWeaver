CWE_20_RULE = """
[CWE-20 Reference Guideline | Improper Input Validation | Non-binding, Evidence-first]

Overview
- CWE-20 occurs when a product receives input or data but fails to properly validate it, or performs incorrect validation, making the system operate on untrusted or improperly validated data.
- This can lead to a variety of vulnerabilities, including buffer overflows, injection attacks, or unexpected behavior. The failure to validate input effectively often allows attackers to manipulate the system into processing malicious or incorrectly formatted data.
- In partial snippets, missing or inadequate input validation evidence is not proof of vulnerability. Use this guideline to form hypotheses and identify code evidence that would confirm or refute them.

What counts as “input validation” (static analysis framing)
- Input validation:
  - The process of checking data received from a user or external system to ensure that it meets expected formats, types, ranges, and constraints before being processed.
- Types of data that require validation:
  - User input: form fields, query parameters, headers, cookies.
  - External system input: API requests, file uploads, network traffic.
  - Data from other internal processes or modules that the system relies on.

Where improper input validation issues typically arise (sensitive sinks)
- User inputs:
  - Forms, query parameters, cookies, headers, and any untrusted source of data that the system processes.
- Data ingestion from external sources:
  - File uploads, third-party API responses, external databases.
- Data processing points:
  - Before using the data to update databases, call other systems, or generate responses.

Common failure modes (reasoning hints, not assumptions)
- Missing validation:
  - Accepting data without any form of validation (e.g., relying on the client-side validation only).
- Incorrect validation:
  - Improperly validating data (e.g., allowing malformed or harmful data to pass, allowing SQL injection or buffer overflows).
- Overly permissive validation:
  - Accepting data that is too broad or vague (e.g., accepting any string without checking for length, special characters, or malicious patterns).
- No sanitization of input:
  - Failing to sanitize input before passing it to sensitive operations (e.g., SQL queries, shell commands, filesystem operations).
- Lack of boundary checks:
  - Accepting input that exceeds expected sizes or ranges, leading to overflows, memory corruption, or unexpected behavior.

What “proper input validation” looks like (context-specific)
- Define clear validation rules:
  - Set specific rules for each type of input (e.g., length checks, type checks, allowed character sets, allowed value ranges).
- Sanitize user input:
  - Ensure that input is cleaned or transformed to prevent malicious data from being processed (e.g., escaping special characters for SQL queries).
- Validate all input:
  - Ensure validation occurs on both client-side and server-side, with emphasis on server-side validation as it is more secure.
- Apply the principle of least privilege:
  - Ensure that only the minimal necessary data is accepted. Reject input that does not conform to these requirements.

Common weak/insufficient defenses (signals of possible risk)
- Relying on client-side validation alone:
  - Client-side validation can be bypassed, so validation must also be implemented server-side.
- Insufficient checks for edge cases:
  - Allowing input that is outside expected ranges or lengths, which may lead to unexpected system behavior.
- Failing to sanitize input:
  - Accepting input directly into sensitive processes (e.g., SQL queries, shell execution) without escaping or sanitizing it.
- Unchecked buffer sizes:
  - Allowing inputs to be written to buffers without ensuring that the input fits the buffer size, potentially leading to buffer overflows.

Evidence to look for in code (static snippet oriented)
- Strong evidence of mitigation:
  - Input is validated against strict and specific rules (e.g., length checks, regex for specific formats, numeric range checks).
  - Input is sanitized to prevent harmful characters or code (e.g., escaping SQL special characters, using parameterized queries).
  - Boundary conditions are checked (e.g., checking that input fits within buffer sizes).
  - Input validation is done consistently on both the client-side and server-side.
- Evidence suggesting vulnerability:
  - Input is accepted without validation or only validated on the client-side (e.g., no validation checks for user input before it is processed).
  - Input is passed directly into sensitive operations (e.g., SQL queries, shell commands) without sanitization or escaping.
  - Input is accepted without boundary checks, potentially leading to buffer overflows or other forms of data corruption.

How to use this guideline under incomplete context
- Identify the input sources:
  - Where is the input coming from (e.g., user input, external APIs, file uploads)?
- Identify what validation is being done:
  - Are there any explicit checks for length, type, format, or value ranges? Are they sufficient?
- Generate a small number of targeted hypotheses:
  - H1: Input is not being validated before being processed or used.
  - H2: Input is validated incorrectly (e.g., weak checks, improperly sanitized).
  - H3: Input validation exists but is not applied uniformly across all sources and methods.
  - H4: Input validation is done externally or by frameworks, not visible in this snippet.
- For each hypothesis, specify:
  (a) evidence in the snippet supporting it (absence of validation logic, unsafe data handling),
  (b) evidence needed to confirm it (input validation logic, sanitization methods, boundary checks),
  (c) counter-evidence that would refute it (explicit validation, proper sanitization, boundary control).

Quick red flags in partial code (weak → strong)
- Strong: input is passed directly to sensitive operations (e.g., SQL queries, file operations, system commands) without validation or sanitization.
- Medium: input is validated by weak or incorrect rules (e.g., only checking for length but not allowed characters or format).
- Medium: validation occurs in some parts of the code but is missing in others.
- Weak: input validation may be handled in external frameworks or helpers not shown in the snippet → treat as Unknown and reduce confidence.
"""
if __name__ == "__main__":
    print(CWE_20_RULE)
